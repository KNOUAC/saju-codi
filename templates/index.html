<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI 사주 코디네이터</title>
    <link href="https://fonts.googleapis.com/css2?family=Gothic+A1:wght@400;700&family=Noto+Serif+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --coral: #E9967A; --purple: #6a1b9a; }
        body {
            font-family: 'Gothic A1', sans-serif;
            background: #f8f9fa; margin: 0; padding: 20px;
            display: flex; justify-content: center; align-items: flex-start; /* 상단 정렬 */
            min-height: 100vh; box-sizing: border-box;
        }
        .container {
            background: white; padding: 25px; border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08); width: 100%; max-width: 400px;
        }
        h1 { font-size: 1.2rem; text-align: center; color: #333; margin-bottom: 20px; }
        
        /* 피커 스타일 */
        .picker-box {
            position: relative; height: 200px; display: flex;
            background: #fff; border-radius: 15px; overflow: hidden; margin-bottom: 20px;
        }
        .picker-highlight {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 95%; height: 40px; background: rgba(0,0,0,0.04); border-radius: 10px; pointer-events: none;
        }
        .wheel {
            flex: 1; height: 100%; overflow-y: scroll; scroll-snap-type: y mandatory;
            scrollbar-width: none; -ms-overflow-style: none;
        }
        .wheel::-webkit-scrollbar { display: none; }
        .wheel ul { list-style: none; padding: 80px 0; margin: 0; }
        .wheel li {
            height: 40px; display: flex; align-items: center; justify-content: center;
            scroll-snap-align: center; color: #ccc; transition: 0.2s; font-size: 1rem;
        }
        .wheel li.active { color: #333; font-weight: bold; font-size: 1.1rem; }

        .time-input {
            width: 100%; padding: 12px; border: 1px solid #eee; border-radius: 10px;
            margin-bottom: 20px; font-family: 'Gothic A1'; box-sizing: border-box;
        }

        .btn-submit {
            width: 100%; padding: 16px; background: var(--coral); color: white;
            border: none; border-radius: 15px; font-size: 1.1rem; font-weight: bold;
            cursor: pointer; transition: 0.3s;
        }

        #result {
            margin-top: 25px; font-family: 'Noto Serif KR', serif; /* 본명조 */
            line-height: 1.8; color: #444;
        }
        details { background: #fdfdfd; padding: 12px; border-radius: 12px; margin-bottom: 10px; border: 1px solid #f0f0f0; }
        summary { font-family: 'Gothic A1'; font-weight: bold; color: var(--purple); cursor: pointer; }
        .loader { display: none; text-align: center; margin-top: 15px; color: #999; }
    </style>
</head>
<body>
    <div class="container">
        <h1>날짜선택</h1>
        
        <div class="picker-box">
            <div class="picker-highlight"></div>
            <div class="wheel" id="year-wheel"><ul id="year-list"></ul></div>
            <div class="wheel" id="month-wheel"><ul id="month-list"></ul></div>
            <div class="wheel" id="day-wheel"><ul id="day-list"></ul></div>
        </div>

        <input type="text" id="time" class="time-input" placeholder="태어난 시간 (모르면 비워둠)">

        <button class="btn-submit" id="submit-btn" onclick="analyzeSaju()">
            날짜를 선택해주세요
        </button>
        
        <div class="loader" id="loader">✨ 기운을 분석하고 있습니다...</div>
        <div id="result"></div>
    </div>

    <script>
        const wheels = ['year', 'month', 'day'];
        const data = { year: [1950, 2026], month: [1, 12], day: [1, 31] };

        function init() {
            wheels.forEach(w => {
                const list = document.getElementById(`${w}-list`);
                for(let i=data[w][0]; i<=data[w][1]; i++) {
                    const li = document.createElement('li');
                    li.innerText = i + (w==='year'?'년':w==='month'?'월':'일');
                    li.dataset.val = i;
                    list.appendChild(li);
                }
                document.getElementById(`${w}-wheel`).addEventListener('scroll', updateDisplay);
            });
            // 초기 위치 (1995년)
            document.getElementById('year-wheel').scrollTop = (1995-1950)*40;
            setTimeout(updateDisplay, 100);
        }

        function updateDisplay() {
            const vals = wheels.map(w => {
                const wheel = document.getElementById(`${w}-wheel`);
                const idx = Math.round(wheel.scrollTop / 40);
                const items = wheel.querySelectorAll('li');
                items.forEach(li => li.classList.remove('active'));
                if(items[idx]) items[idx].classList.add('active');
                return items[idx] ? items[idx].dataset.val : data[w][0];
            });

            const date = new Date(vals[0], vals[1]-1, vals[2]);
            const week = ['일', '월', '화', '수', '목', '금', '토'][date.getDay()];
            document.getElementById('submit-btn').innerText = `${vals[1]}월 ${vals[2]}일(${week}) 선택`;
            return vals;
        }

        async function analyzeSaju() {
            const vals = updateDisplay();
            const time = document.getElementById('time').value;
            document.getElementById('loader').style.display = 'block';
            document.getElementById('result').innerHTML = "";

            const res = await fetch('/analyze', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({year: vals[0], month: vals[1], day: vals[2], time})
            });
            const json = await res.json();
            document.getElementById('result').innerHTML = json.result;
            document.getElementById('loader').style.display = 'none';
        }

        init();
    </script>
</body>
</html>
